<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Telescope Control - Flymoon</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='telescope.css') }}">
</head>
<body>
    <div class="header-row">
        <a href="/" style="text-decoration: none;">
            <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Flymoon Transit Tracker" class="logo" />
        </a>
        <div style="flex: 1; text-align: center;">
            <div style="font-size: 1.2em;">üî≠ Seestar S50 Control</div>
            <div id="lastUpdateStatus" style="font-size: 0.9em; color: #666; margin-top: 4px;"></div>
        </div>
        <a href="/" class="btn-sm">‚Üê Back</a>
    </div>

    <div class="telescope-container">
        <!-- Status Message Area -->
        <div id="statusMessage" class="status-message"></div>

        <!-- Main Layout: Preview + Controls -->
        <div class="telescope-layout">
            
            <!-- Left Column: Live Preview -->
            <div class="preview-column">
                <div class="preview-panel">
                    <h2><span id="previewTitleIcon">‚ö´</span> Live Preview</h2>
                    <div class="preview-container" id="previewContainer">
                        <img id="previewImage" src="" alt="Live Preview" style="display: none;">
                        <div class="preview-placeholder" id="previewPlaceholder">
                            <div class="placeholder-icon">üìπ</div>
                            <div class="placeholder-text">Connect telescope to view live stream</div>
                        </div>
                    </div>
                    <div class="preview-status" id="previewStatus">
                        <span class="status-dot" id="previewStatusDot"></span>
                        <span id="previewStatusText">Preview Inactive</span>
                    </div>
                </div>

                <!-- File Management Panel -->
                <div class="files-panel">
                    <h2>üìÅ Captured Files</h2>
                    <div class="files-controls">
                        <button id="refreshFilesBtn" class="btn-sm" onclick="refreshFiles()" disabled>üîÑ Refresh</button>
                        <span id="fileCount" class="file-count">0 files</span>
                    </div>
                    <div id="filesList" class="files-grid">
                        <p class="files-empty">Connect to telescope to view files</p>
                    </div>
                </div>
            </div>

            <!-- Right Column: Controls -->
            <div class="controls-column">
                
                <!-- Connection Panel -->
                <div class="control-panel">
                    <h3>Connection</h3>
                    <div class="connection-status">
                        <div class="status-indicator">
                            <span class="status-dot" id="statusDot"></span>
                            <span id="connectionStatus">Disconnected</span>
                        </div>
                        <div class="connection-info" id="connectionInfo"></div>
                    </div>
                    <div class="button-row">
                        <button id="connectBtn" class="btn btn-primary" onclick="connect()">üîå Connect</button>
                        <button id="disconnectBtn" class="btn btn-secondary" onclick="disconnect()" disabled>üîå Disconnect</button>
                    </div>
                </div>

                <!-- Target Selection Panel -->
                <div class="control-panel">
                    <h3>üéØ Target Selection</h3>
                    <div id="targetVisibility" class="target-visibility">
                        <div class="target-status" id="sunStatus">
                            <span class="target-icon">‚òÄÔ∏è</span>
                            <div class="target-info">
                                <div class="target-name">Sun</div>
                                <div class="target-coords" id="sunCoords">--</div>
                            </div>
                            <span class="visibility-badge" id="sunBadge">--</span>
                        </div>
                        <div class="target-status" id="moonStatus">
                            <span class="target-icon">üåô</span>
                            <div class="target-info">
                                <div class="target-name">Moon</div>
                                <div class="target-coords" id="moonCoords">--</div>
                            </div>
                            <span class="visibility-badge" id="moonBadge">--</span>
                        </div>
                    </div>
                    <div class="button-row">
                        <button id="targetSunBtn" class="btn btn-secondary" onclick="switchToSun()" disabled>‚òÄÔ∏è View Sun</button>
                        <button id="targetMoonBtn" class="btn btn-secondary" onclick="switchToMoon()" disabled>üåô View Moon</button>
                    </div>
                    <div id="targetWarning" class="warning-box" style="display: none;"></div>
                </div>

                <!-- Capture Controls Panel -->
                <div class="control-panel">
                    <h3>üì∏ Capture Controls</h3>
                    
                    <!-- Photo Capture -->
                    <div class="capture-section">
                        <div class="capture-header">
                            <span class="capture-icon">üì∑</span>
                            <span class="capture-label">Photo</span>
                        </div>
                        <div class="capture-controls">
                            <div class="input-group">
                                <label for="exposureTime">Exposure (s):</label>
                                <input type="number" id="exposureTime" value="1.0" min="0.1" max="30" step="0.1" class="input-sm">
                            </div>
                            <button id="capturePhotoBtn" class="btn btn-primary" onclick="capturePhoto()" disabled>üì∏ Capture Photo</button>
                        </div>
                    </div>

                    <!-- Video Recording -->
                    <div class="capture-section">
                        <div class="capture-header">
                            <span class="capture-icon">üìπ</span>
                            <span class="capture-label">Video Recording</span>
                        </div>
                        <div class="capture-controls">
                            <div class="input-group">
                                <label for="videoDuration">Duration (s):</label>
                                <input type="number" id="videoDuration" value="30" min="1" max="3600" step="1" class="input-sm">
                            </div>
                            <div class="input-group">
                                <label for="frameInterval">Timelapse Interval (s):</label>
                                <input type="number" id="frameInterval" value="0" min="0" max="60" step="0.1" class="input-sm" title="0 = normal video, >0 = timelapse">
                            </div>
                            <div class="recording-status" id="recordingStatus">
                                <span class="status-dot" id="recordingDot"></span>
                                <span id="recordingText">Not Recording</span>
                                <span id="recordingTimer" style="margin-left: 8px; color: #039c9c;"></span>
                            </div>
                            <div class="button-row">
                                <button id="startRecordingBtn" class="btn btn-primary" onclick="startRecording()" disabled>‚è∫Ô∏è Start Recording</button>
                                <button id="stopRecordingBtn" class="btn btn-danger" onclick="stopRecording()" disabled style="display: none;">‚èπÔ∏è Stop Recording</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Info Panel -->
                <div class="info-panel">
                    <h3>‚ÑπÔ∏è Tips</h3>
                    <ul class="tips-list">
                        <li><strong>Live Preview:</strong> Streams at 10 FPS for real-time viewing</li>
                        <li><strong>Solar Warning:</strong> Always use solar filter when viewing Sun</li>
                        <li><strong>Photo Mode:</strong> Works in Solar/Lunar/Scenery modes only</li>
                        <li><strong>Recording:</strong> Saves MP4 video to telescope storage</li>
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='telescope.js') }}?v=9"></script>
</body>
</html>
